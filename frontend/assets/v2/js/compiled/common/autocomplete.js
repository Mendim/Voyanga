// Generated by CoffeeScript 1.4.0
var _this = this;

ko.bindingHandlers.autocomplete = {
  init: function(element, valueAccessor) {
    $(element).bind("focus", function() {
      return $(element).change();
    });
    $(element).typeahead({
      name: 'cities',
      limit: 10,
      prefetch: '/js/cities.json',
      template: '<div title="{{value}}"><span class="city">{{name}}, </span><span class="country">{{country}}</span><span class="code">{{code}}</span></div>',
      engine: Hogan
    });
    return $(element).on('typeahead:selected', function(e, data) {
      valueAccessor().iata(data.code);
      valueAccessor().readable(data.name);
      valueAccessor().readableGen(data.nameGen);
      valueAccessor().readableAcc(data.nameAcc);
      valueAccessor().readablePre(data.namePre);
      $(element).val(data.name);
      return $(element).parent().siblings('input.input-path').val(data.value + ', ' + data.country);
    });
  },
  update: function(element, valueAccessor) {
    var iataCode;
    iataCode = valueAccessor().iata();
    return $(element).typeahead("setQuery", iataCode).data('ttView').datasets[0].getSuggestions(iataCode, function(s) {
      var data;
      data = s[0].datum;
      $(element).val(data.name);
      valueAccessor().readable(data.name);
      valueAccessor().readableGen(data.nameGen);
      valueAccessor().readableAcc(data.nameAcc);
      return valueAccessor().readablePre(data.namePre);
    });
  }
};
