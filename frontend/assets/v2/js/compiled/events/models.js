// Generated by CoffeeScript 1.3.3
var City, Event, EventCategory, EventCategorySet, EventLink, EventLinkSet, EventPrice, EventPriceSet, EventSet, EventTag, EventTagSet, EventTour, EventTourSet,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ko.bindingHandlers.highlightChange = {
  update: function(element, valueAccessor, allBindingsAccessor) {
    var allBindings, newEl, previousImage, value, valueUnwrapped, varLeftPos, varLeftPosStart, varTopPos, varTopPosStart;
    value = valueAccessor();
    allBindings = allBindingsAccessor();
    valueUnwrapped = ko.utils.unwrapObservable(value);
    previousImage = allBindings.previousImage;
    newEl = $('<div class="IMGmain"><img src=""></div>');
    newEl.appendTo(".centerTours");
    $(".IMGmain").eq(0).find('img').attr("src", previousImage());
    indexIMGresizeCenter(0);
    varLeftPos = $(".IMGmain").eq(1).css("left");
    varTopPos = $(".IMGmain").eq(1).css("top");
    varLeftPos = parseInt(varLeftPos.slice(0, -2));
    varTopPos = parseInt(varTopPos.slice(0, -2));
    varLeftPosStart = varLeftPos;
    varTopPosStart = varTopPos;
    $(".IMGmain").eq(1).css("opacity", "0").css("left", varLeftPosStart + "px").css("top", varTopPosStart + "px").find("img").attr("src", valueUnwrapped);
    previousImage(valueUnwrapped);
    slideToursSlide();
    ResizeAvia();
    return $(".IMGmain").eq(1).find("img").load(function() {
      indexIMGresizeCenter(1);
      $(".IMGmain").eq(0).animate({
        opacity: 0
      }, speedAnimateChangePic, function() {
        return $(".IMGmain:not(:last-child)").eq(0).remove();
      });
      return $(".IMGmain").eq(1).animate({
        opacity: 1
      }, speedAnimateChangePic);
    });
  }
};

Event = (function(_super) {

  __extends(Event, _super);

  function Event(data) {
    var _this = this;
    this.startDate = ko.observable(new Date(data.startDate));
    this.endDate = ko.observable(new Date(data.endDate));
    this.address = ko.observable(data.address);
    this.contact = ko.observable(data.contact);
    this.preview = ko.observable(data.preview);
    this.description = ko.observable(data.description);
    this.title = ko.observable(data.title);
    this.categories = ko.observableArray(new EventCategorySet(data.categories));
    this.links = ko.observableArray(new EventLinkSet(data.links));
    this.tags = ko.observableArray(new EventTagSet(data.tags));
    this.prices = ko.observableArray(new EventPriceSet(data.prices));
    this.tour = ko.observable(new EventTourSet(data.tours));
    this.image = ko.observable(data.image);
    this.thumb = ko.observable(data.thumb);
    this.active = ko.observable(data.active);
    this.minimalPrice = ko.computed(function() {
      return _this.prices()[0].price;
    });
  }

  Event.prototype.duration = function() {
    return dateUtils.formatDuration(this._duration);
  };

  return Event;

})(Backbone.Events);

EventSet = (function() {

  function EventSet(events) {
    this.closeEventsMaps = __bind(this.closeEventsMaps, this);

    this.closeEventsPhoto = __bind(this.closeEventsPhoto, this);

    this.setActive = __bind(this.setActive, this);

    var _this = this;
    console.trace();
    this.events = ko.observableArray(events);
    this.currentTitle = ko.observable('HUY');
    this.currentEvent = ko.computed(function() {
      var activeEvents;
      activeEvents = _.filter(_this.events(), function(event) {
        return event.active();
      });
      console.log("SETTING TAITL", activeEvents[0].title());
      _this.currentTitle(activeEvents[0].title());
      return activeEvents[0];
    });
    this.previousImage = ko.observable('');
    this.activeMaps = 0;
  }

  EventSet.prototype.setActive = function(valueAccessor, event) {
    var _this = this;
    if (this.activeMaps === 1) {
      this.closeEventsMaps();
    }
    $('.slideTours').find('.triangle').animate({
      'top': '0px'
    }, 200);
    this.events(_.map(this.events(), function(event) {
      return event.active(false);
    }));
    valueAccessor.active(true);
    return $(event.target).closest('.toursTicketsMain').find('.triangle').animate({
      'top': '-16px'
    }, 200);
  };

  EventSet.prototype.closeEventsPhoto = function() {
    $(".slideTours").find(".active").find(".triangle").animate({
      top: "0px"
    }, 200);
    $(".toursTicketsMain").removeClass("active");
    $(".mapsBigAll").css("opacity", "0");
    $(".toursBigAll").animate({
      opacity: 0
    }, 700, function() {
      return $(this).css("display", "none");
    });
    $(".mapsBigAll").show();
    $(".mapsBigAll").animate({
      opacity: 1
    }, 700);
    return this.activeMaps = 1;
  };

  EventSet.prototype.closeEventsMaps = function() {
    $(".toursBigAll").css("opacity", "0");
    $(".mapsBigAll").animate({
      opacity: 0
    }, 700, function() {
      return $(this).css("display", "none");
    });
    $(".toursBigAll").show();
    $(".toursBigAll").animate({
      opacity: 1
    }, 700);
    return this.activeMaps = 0;
  };

  return EventSet;

})();

EventCategory = (function() {

  function EventCategory(data) {
    this.id = ko.observable(data.id);
    this.title = ko.observable(data.title);
  }

  return EventCategory;

})();

EventCategorySet = (function() {

  function EventCategorySet(data) {
    var set;
    set = [];
    $.each(data, function(i, eventCategory) {
      return set.push(new EventCategory(eventCategory));
    });
    return set;
  }

  return EventCategorySet;

})();

EventLink = (function() {

  function EventLink(data) {
    this.title = ko.observable(data.title);
    this.url = ko.observable(data.url);
  }

  return EventLink;

})();

EventLinkSet = (function() {

  function EventLinkSet(data) {
    var set;
    set = [];
    $.each(data, function(i, eventLink) {
      return set.push(new EventLink(eventLink));
    });
    return set;
  }

  return EventLinkSet;

})();

EventTag = (function() {

  function EventTag(data) {
    this.name = ko.observable(data.name);
  }

  return EventTag;

})();

EventTagSet = (function() {

  function EventTagSet(data) {
    var set;
    set = [];
    $.each(data, function(i, eventTag) {
      return set.push(new EventTag(eventTag));
    });
    return set;
  }

  return EventTagSet;

})();

City = (function() {

  function City(data) {
    this.title = ko.observable(data.title);
  }

  return City;

})();

EventPrice = (function() {

  function EventPrice(data) {
    this.city = ko.observable(new City(data.city));
    this.price = ko.observable(data.price);
  }

  return EventPrice;

})();

EventPriceSet = (function() {

  function EventPriceSet(data) {
    var set;
    set = [];
    $.each(data, function(i, eventPrice) {
      return set.push(new EventPrice(eventPrice));
    });
    return set;
  }

  return EventPriceSet;

})();

EventTour = (function() {

  function EventTour(data) {
    this.name = data.name;
  }

  return EventTour;

})();

EventTourSet = (function() {

  function EventTourSet(data) {
    var set;
    set = [];
    $.each(data, function(i, tour) {
      return set.push(new EventTour(tour));
    });
    return set;
  }

  return EventTourSet;

})();
